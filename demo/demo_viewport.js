(()=>{"use strict";var e,t={980:(e,t,i)=>{var s=i(710),n=i(753),r=i(486);class a extends r.A{get materialSet(){return this._materialSet}set materialSet(e){const t=e===this._materialSet;this._materialSet=e,t||this.updateMaterial()}get isOver(){return this._isOver}get isPress(){return this._isPress}get enabled(){return this._enable}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e&&(this._isPress=!1,this._isOver=!1)}constructor(e){super(),this._isPress=!1,this._isOver=!1,this._enable=!0,this.mouseEnabled=!0,this._frozen=!1,this.state="normal",this._alpha=1,this.view=e.view,this._materialSet??=e.material,this.updateMaterial()}onMouseDownHandler(e){this.checkActivity()&&(this._isPress=!0,this.updateState("down"),this.emit(e.type,e))}onMouseUpHandler(e){const t=this._isPress;if(this._isPress=!1,!this.checkActivity())return;const i=this._isOver?"over":"normal";if(this.updateState(i),this.emit(e.type,e),t){this.onMouseClick();const e=_.generate("click",this);this.emit(e.type,e)}}onMouseClick(){}onMouseOverHandler(e){this.onMouseOverOutHandler(e)}onMouseOutHandler(e){this.onMouseOverOutHandler(e)}onMouseOverOutHandler(e){this._isOver="over"===e.type,"out"===e.type&&(this._isPress=!1),this.checkActivity()&&(this.updateState(this._isOver?"over":"normal"),this.emit(e.type,e))}set alpha(e){this._alpha=e,this.updateMaterial()}updateState(e){this.state=e,this.updateMaterial()}checkActivity(){return this._enable&&!this.frozen}enable(){this.switchEnable(!0)}disable(){this.switchEnable(!1)}updateMaterial(){this._materialSet?.setOpacity(this._alpha);const e=this._materialSet?.getMaterial(this.state,this._enable);if(e)switch(this.view.type){case"Mesh":case"Sprite":this.view.material=e.material}}switchEnable(e){this._enable=e,e||(this._isPress=!1,this._isOver=!1),this.state=e?"normal":"disable",this.updateMaterial()}}class o extends a{constructor(){super(...arguments),this._isSelect=!1}onMouseClick(){if(!this.checkActivity())return;this._isSelect=!this._isSelect;const e=_.generate("select",this);this.emit(e.type,e),this.updateMaterial()}get selection(){return this._isSelect}set selection(e){e!==this._isSelect&&this.checkActivity()&&(this._isSelect=e,this._isPress=!1,this.updateMaterial())}updateMaterial(){this.materialSet?.setOpacity(this._alpha);const e=this.materialSet?.getMaterial(this.state,this._enable,this._isSelect);null!=e?.material&&(this.view.material=e.material)}}class l extends o{constructor(){super(...arguments),this._isExclusivelySelected=!1}checkActivity(){return this._enable&&!this._isExclusivelySelected}get isExclusivelySelected(){return this._isExclusivelySelected}set isExclusivelySelected(e){this._isExclusivelySelected=e}get isFrozen(){return this._isExclusivelySelected}set isFrozen(e){this._isExclusivelySelected=e}calculateCurrentState(){return this._enable?this._isPress?"down":this._isOver?"over":"normal":"disable"}_setSelectionOverride(e){if(this._isSelect=e,e)this.updateState("normal");else{const e=this.calculateCurrentState();this.updateState(e)}}}var c=i(961);class h{constructor(e,t,i,n){this.raycaster=new s.tBo,this.mouse=new s.I9Y,this.currentOver=[],this.hasThrottled=!1,this.throttlingDelta=0,this._disposed=!1,this.onTick=e=>this.throttlingTime_ms<=0?(this.hasThrottled=!1,void(this.throttlingDelta=0)):Number.isFinite(e.delta)?(this.throttlingDelta+=Math.max(e.delta,0),void(this.throttlingDelta<this.throttlingTime_ms||(this.hasThrottled=!1,this.throttlingDelta%=this.throttlingTime_ms))):(this.hasThrottled=!1,void(this.throttlingDelta=0)),this.onDocumentMouseMove=e=>{if(this.throttlingTime_ms>0){if(this.hasThrottled)return;this.hasThrottled=!0}e.preventDefault();const t=this.getIntersects(e);if(0===t.length)return void this.clearOver();const i=this.currentOver;this.currentOver=[];for(const e of t)if(this.checkTarget(e.object,"over"))break;i?.forEach((e=>{this.currentOver.includes(e)||h.onButtonHandler(e,"out")}))},this.onDocumentMouseUpDown=e=>{let t="down";switch(e.type){case"pointerdown":t="down";break;case"pointerup":t="up"}if(!function(e,t,i){if(null==t)return!0;const s=g(e,t);return i.offsetX>=s.x1&&i.offsetX<=s.x2&&i.offsetY>=s.y1&&i.offsetY<=s.y2}(this.canvas,this.viewport,e)&&"down"===t)return;e.preventDefault();const i=this.getIntersects(e);this.checkIntersects(i,t)},this.camera=t,this.scene=e,this.throttlingTime_ms=n?.throttlingTime_ms??33,this.viewport=n?.viewport,this.recursive=n?.recursive??!0,this.targets=n?.targets??this.scene.children,this.canvas=i,i.addEventListener("pointermove",this.onDocumentMouseMove,!1),i.addEventListener("pointerdown",this.onDocumentMouseUpDown,!1),i.addEventListener("pointerup",this.onDocumentMouseUpDown,!1),c.w.on("tick",this.onTick)}clearOver(){this.currentOver?.forEach((e=>{h.onButtonHandler(e,"out")})),this.currentOver=[]}checkIntersects(e,t){const i=e.length;if(0!==i)for(let s=0;s<i&&!this.checkTarget(e[s].object,t);s++);}static onButtonHandler(e,t){switch(t){case"down":return void e.interactionHandler.onMouseDownHandler(_.generate(t,e));case"up":return void e.interactionHandler.onMouseUpHandler(_.generate(t,e));case"over":return void(e.interactionHandler.isOver||e.interactionHandler.onMouseOverHandler(_.generate(t,e)));case"out":return void(e.interactionHandler.isOver&&e.interactionHandler.onMouseOutHandler(_.generate(t,e)))}}static implementsIClickableObject3D(e){return null!==e&&"object"==typeof e&&"interactionHandler"in e&&null!==e.interactionHandler&&"object"==typeof e.interactionHandler&&"mouseEnabled"in e.interactionHandler&&null!==e.interactionHandler.mouseEnabled&&"boolean"==typeof e.interactionHandler.mouseEnabled}static implementsDepartedIClickableObject3D(e){return null!==e&&"object"==typeof e&&"model"in e&&null!==e.model&&"object"==typeof e.model}checkTarget(e,t,i=!1){return h.implementsDepartedIClickableObject3D(e)&&console.warn("Deprecated: IClickableObject3D.model is deprecated. Please use IClickableObject3D.interactionHandler."),null!=e&&h.implementsIClickableObject3D(e)&&e.interactionHandler.mouseEnabled?("over"===t&&this.currentOver.push(e),h.onButtonHandler(e,t),this.checkTarget(e.parent,t,!0)):null!=e&&null!=e.parent&&"Scene"!==e.parent.type?this.checkTarget(e.parent,t,i):i}getIntersects(e){!function(e,t,i,n){const{x:r,y:a}=function(e,t,i){return i?function(e,t,i){const s=g(e,i),n=t.offsetX-s.x1,r=t.offsetY-s.y1;return{x:n/(s.x2-s.x1)*2-1,y:-r/(s.y2-s.y1)*2+1}}(e,t,i):function(e,t){const i=t.offsetX/function(e){return e.clientWidth}(e)*2-1;return{x:i,y:-t.offsetY/f(e)*2+1}}(e,t)}(e,t,i);if(n)return n.set(r,a),n;new s.I9Y(r,a)}(this.canvas,e,this.viewport,this.mouse),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.intersectObjects(this.targets,this.recursive),i=new Set;return t.filter((e=>!i.has(e.object.uuid)&&(i.add(e.object.uuid),!0)))}dispose(){this._disposed||(this._disposed=!0,this.clearOver(),this.canvas.removeEventListener("pointermove",this.onDocumentMouseMove,!1),this.canvas.removeEventListener("pointerdown",this.onDocumentMouseUpDown,!1),this.canvas.removeEventListener("pointerup",this.onDocumentMouseUpDown,!1),c.w.off("tick",this.onTick),this.hasThrottled=!1,this.throttlingDelta=0)}}class u extends r.A{constructor(){super(...arguments),this._interactionHandlers=[],this.onSelectedButton=e=>{e.isSelected&&this.select(e.interactionHandler)}}addButton(...e){e.forEach((e=>{this.addInteractionHandler(e.interactionHandler)}))}addInteractionHandler(e){this._interactionHandlers.push(e),e.on("select",this.onSelectedButton)}removeButton(e){this.removeInteractionHandler(e.interactionHandler)}removeInteractionHandler(e){const t=this._interactionHandlers.indexOf(e);return t>-1&&(this._interactionHandlers.splice(t,1),e.off("select",this.onSelectedButton)),e}select(e){if(-1===this._interactionHandlers.indexOf(e))return void console.warn("管理下でないボタンが選択処理されました。");if(e===this._selected&&e.isExclusivelySelected)return;this._selected=e;for(const t of this._interactionHandlers)t.isExclusivelySelected=t===e,t._setSelectionOverride(t===e);const t=_.generate("select",e);this.emit(t.type,t)}get selected(){return this._selected}get interactionHandlers(){return this._interactionHandlers}}class d{constructor(e){this.alpha=1,this.material=e}updateAlpha(){Array.isArray(this._material)?this.alphaArray=this.getAlphaArray():this.alpha=this._material.opacity}getAlphaArray(){const e=this._material,t=e.length,i=[];for(let s=0;s<t;s++)i.push(e[s].opacity);return i}set material(e){this._material=e,this.updateAlpha()}get material(){return this._material}setOpacity(e){if(Array.isArray(this._material)){const t=this._material.length;for(let i=0;i<t;i++)this._material[i].opacity=e*this.alphaArray[i]}else this._material.opacity=e*this.alpha}}class p{constructor(e){this.materials=[],this.normal=new d(e.normal),this.over=p.initMaterial(e.over,this.normal),this.down=p.initMaterial(e.down,this.normal),this.disable=p.initMaterial(e.disable,this.normal),this.normalSelect=p.initMaterial(e.normalSelect,this.normal),this.overSelect=p.initMaterial(e.overSelect,this.normal),this.downSelect=p.initMaterial(e.downSelect,this.normal),this.init()}static initMaterial(e,t){return null==e?t:new d(e)}init(){if(null==this.normal)throw new Error("通常状態のマテリアルが指定されていません。");this.materials=[this.normal,this.normalSelect,this.over,this.overSelect,this.down,this.downSelect,this.disable]}getMaterial(e,t,i=!1){if(!t)return this.disable;switch(e){case"normal":return i?this.normalSelect:this.normal;case"down":return i?this.downSelect:this.down;case"over":return i?this.overSelect:this.over}return this.normal}setOpacity(e){this.materials.forEach((t=>{t.setOpacity(e)}))}}function v(e){return null!=e&&"interactionHandler"in e?e.interactionHandler:e}function m(e){if(null!=e&&"selection"in e)return!!e.selection;throw new Error("選択可能なボタン以外を引数にして、SELECTイベントをインスタンス化しました。SELECTイベントはISelectableObject3Dを実装したクラスとともにインスタンス化してください。")}function w(e,t){const i=v(t);return{type:e,interactionHandler:i,isSelected:(()=>{if("select"===e)return m(i)})()}}const _={getInteractionHandler:v,getSelection:m,generate:w,clone:function(e){return w(e.type,e.interactionHandler)}};function f(e){return e.clientHeight}function g(e,t){const i=f(e);return{x1:t.x,x2:t.x+t.width,y1:i-(t.y+t.height),y2:i-t.y}}s.YJl;class b extends s.eaF{constructor(e,t){super(e.geo),this.interactionHandler=new t({view:this,material:e.material})}}class y extends b{constructor(e){super(e,a)}}class S extends b{constructor(e){super(e,o)}}class O extends b{constructor(e){super(e,l)}}class H extends s.kxk{constructor(e,t){super(),this.interactionHandler=new t({view:this,material:e})}}class M extends H{constructor(e){super(e,a)}}class x extends H{constructor(e){super(e,o)}}class k{bg;viewport;scene;camera;manager;constructor(e,t,i,n,r,a){this.viewport=new s.IUQ(e,t,i,n),this.bg=a,this.scene=new s.Z58,this.camera=new s.ubm(45,i/n,1,400),this.camera.position.set(0,0,100),this.scene.add(this.camera);const o=new s.$p8(16777215,1);this.scene.add(o),this.manager=new h(this.scene,this.camera,r,{viewport:this.viewport}),A(this.scene),I(this.scene),C(this.scene),P(this.scene),z(this.scene)}render(e){e.setClearColor(this.bg),e.clearDepth(),e.setScissorTest(!0),e.setScissor(this.viewport),e.setViewport(this.viewport),e.clear(),e.render(this.scene,this.camera),e.setScissorTest(!1)}}const E=()=>new p({normal:D(.6),over:D(.8),down:D(1),normalSelect:D(.6,16776960),overSelect:D(.8,16776960),downSelect:D(1,16776960)}),D=(e,t)=>(null==t&&(t=16777215),new s.V9B({color:t,opacity:e,transparent:!0})),T=()=>new p({normal:j("./btn045_01.png",1),over:j("./btn045_02.png",1),down:j("./btn045_03.png",1),normalSelect:j("./btn045_01.png",.5),overSelect:j("./btn045_02.png",.5),downSelect:j("./btn045_03.png",.5)}),j=(e,t,i)=>(null==i&&(i=16777215),new s.RoJ({map:(new s.Tap).load(e),color:i,opacity:t,transparent:!0})),A=e=>{const t=new s.iNn(6,6,6),i=new y({geo:t,material:E()});i.position.set(-10,20,0),e.add(i)},I=e=>{const t=new s.iNn(6,6,6),i=new S({geo:t,material:E()});i.position.set(0,20,0),e.add(i)},C=e=>{const t=new M(T());B(e,t,10)},P=e=>{const t=new x(T());B(e,t,20)},B=(e,t,i)=>{t.position.set(i,20,0),t.scale.set(8,8,8),e.add(t)},z=e=>{const t=new s.iNn(6,6,6),i=(i,s)=>{const n=new O({geo:t,material:E()});return n.position.set(i,-10,0),n.interactionHandler.value=s,e.add(n),n},n=new u;n.addButton(i(-10,"button01"),i(0,Math.PI),i(10,{value01:1,value02:2})),n.addButton(i(20,void 0)),n.on("select",(e=>{console.log(e.interactionHandler.value)}))};window.onload=()=>{const e=document.getElementById("webgl-canvas"),t={canvas:e},i=new n.JeP(t);i.autoClear=!1,i.setSize(1280,900),i.setPixelRatio(window.devicePixelRatio);const s=new k(20,20,480,360,e,2236962),r=new k(480,360,520,480,e,4473924),a=()=>{i.setClearColor(0),i.clear(),s.render(i),r.render(i),requestAnimationFrame(a)};a()}}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var r=i[e]={exports:{}};return t[e](r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,n,r)=>{if(!i){var a=1/0;for(h=0;h<e.length;h++){for(var[i,n,r]=e[h],o=!0,l=0;l<i.length;l++)(!1&r||a>=r)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(o=!1,r<a&&(a=r));if(o){e.splice(h--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[i,n,r]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={411:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var n,r,[a,o,l]=i,c=0;if(a.some((t=>0!==e[t]))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(l)var h=l(s)}for(t&&t(i);c<a.length;c++)r=a[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(h)},i=self.webpackChunk_masatomakino_threejs_interactive_object=self.webpackChunk_masatomakino_threejs_interactive_object||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=s.O(void 0,[121],(()=>s(980)));n=s.O(n)})();