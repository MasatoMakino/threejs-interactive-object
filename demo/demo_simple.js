(()=>{"use strict";var t,e={437:(t,e,i)=>{var s=i(710);s.YJl;class n extends s.eaF{constructor(t,e){super(t.geo),this.interactionHandler=new e({view:this,material:t.material})}}class r extends n{constructor(t){super(t,d)}}class a extends n{constructor(t){super(t,p)}}class o extends n{constructor(t){super(t,m)}}class l extends s.kxk{constructor(t,e){super(),this.interactionHandler=new e({view:this,material:t})}}class c extends l{constructor(t){super(t,d)}}class h extends l{constructor(t){super(t,p)}}var u=i(486);class d extends u.A{get materialSet(){return this._materialSet}set materialSet(t){const e=t===this._materialSet;this._materialSet=t,e||this.updateMaterial()}get isOver(){return this._isOver}get isPress(){return this._isPress}constructor(t){super(),this._isPress=!1,this._isOver=!1,this._enable=!0,this.mouseEnabled=!0,this.frozen=!1,this.state="normal",this._alpha=1,this.view=t.view,this._materialSet??=t.material,this.updateMaterial()}onMouseDownHandler(t){this.checkActivity()&&(this._isPress=!0,this.updateState("down"),this.emit(t.type,t))}onMouseUpHandler(t){if(!this.checkActivity())return;const e=this._isPress;this._isPress=!1;const i=this._isOver?"over":"normal";if(this.updateState(i),this.emit(t.type,t),this._isPress!=e){this.onMouseClick();const e=b.generate("click",this);this.emit(e.type,t)}}onMouseClick(){}onMouseOverHandler(t){this.onMouseOverOutHandler(t)}onMouseOutHandler(t){this.onMouseOverOutHandler(t)}onMouseOverOutHandler(t){this._isOver="over"===t.type,this.checkActivity()&&(this.updateState(this._isOver?"over":"normal"),this.emit(t.type,t))}set alpha(t){this._alpha=t,this.updateMaterial()}updateState(t){this.state=t,this.updateMaterial()}checkActivity(){return this._enable&&!this.frozen}enable(){this.switchEnable(!0)}disable(){this.switchEnable(!1)}updateMaterial(){this._materialSet?.setOpacity(this._alpha);const t=this._materialSet?.getMaterial(this.state,this._enable);if(t)switch(this.view.type){case"Mesh":case"Sprite":this.view.material=t.material}}switchEnable(t){this._enable=t,this.state=t?"normal":"disable",this.updateMaterial()}}class p extends d{constructor(){super(...arguments),this._isSelect=!1}onMouseClick(){this._isSelect=!this._isSelect;const t=b.generate("select",this);this.emit(t.type,t),this.updateMaterial()}get selection(){return this._isSelect}set selection(t){this._isSelect=t,this.updateState("normal")}updateMaterial(){this.materialSet?.setOpacity(this._alpha);const t=this.materialSet?.getMaterial(this.state,this._enable,this._isSelect);null!=t?.material&&(this.view.material=t.material)}}class m extends p{constructor(){super(...arguments),this._isFrozen=!1}checkActivity(){return this._enable&&!this._isFrozen}get isFrozen(){return this._isFrozen}set isFrozen(t){this._isFrozen=t}}class v extends u.A{constructor(){super(),this._interactionHandlers=[],this.onSelectedButton=t=>{t.isSelected&&this.select(t.interactionHandler)}}addButton(...t){t.forEach((t=>{this.addInteractionHandler(t.interactionHandler)}))}addInteractionHandler(t){this._interactionHandlers.push(t),t.on("select",this.onSelectedButton)}removeButton(t){this.removeInteractionHandler(t.interactionHandler)}removeInteractionHandler(t){const e=this._interactionHandlers.indexOf(t);return e>-1&&(this._interactionHandlers.splice(e,1),t.off("select",this.onSelectedButton)),t}select(t){if(-1===this._interactionHandlers.indexOf(t))return void console.warn("管理下でないボタンが選択処理されました。");if(t===this._selected&&t.isFrozen)return;this._selected=t;for(let e of this._interactionHandlers)e.selection=e.isFrozen=e===t;const e=b.generate("select",t);this.emit(e.type,e)}get selected(){return this._selected}get interactionHandlers(){return this._interactionHandlers}}class w{constructor(t){this.alpha=1,this.material=t}updateAlpha(){this._material instanceof Array?this.alphaArray=this.getAlphaArray():this.alpha=this._material.opacity}getAlphaArray(){const t=this._material,e=t.length,i=[];for(let s=0;s<e;s++)i.push(t[s].opacity);return i}set material(t){this._material=t,this.updateAlpha()}get material(){return this._material}setOpacity(t){if(this._material instanceof Array){const e=this._material.length;for(let i=0;i<e;i++)this._material[i].opacity=t*this.alphaArray[i]}else this._material.opacity=t*this.alpha}}class g{constructor(t){this.materials=[],this.normal=new w(t.normal),this.over=g.initMaterial(t.over,this.normal),this.down=g.initMaterial(t.down,this.normal),this.disable=g.initMaterial(t.disable,this.normal),this.normalSelect=g.initMaterial(t.normalSelect,this.normal),this.overSelect=g.initMaterial(t.overSelect,this.normal),this.downSelect=g.initMaterial(t.downSelect,this.normal),this.init()}static initMaterial(t,e){return null==t?e:new w(t)}init(){if(null==this.normal)throw new Error("通常状態のマテリアルが指定されていません。");this.materials=[this.normal,this.normalSelect,this.over,this.overSelect,this.down,this.downSelect,this.disable]}getMaterial(t,e,i=!1){if(!e)return this.disable;switch(t){case"normal":return i?this.normalSelect:this.normal;case"down":return i?this.downSelect:this.down;case"over":return i?this.overSelect:this.over}return this.normal}setOpacity(t){this.materials.forEach((e=>{e.setOpacity(t)}))}}var f=i(961);class _{constructor(t,e,i,n){this.raycaster=new s.tBo,this.mouse=new s.I9Y,this.currentOver=[],this.hasThrottled=!1,this.throttlingDelta=0,this.onTick=t=>{this.throttlingDelta+=Math.max(t.delta,0),this.throttlingDelta<this.throttlingTime_ms||(this.hasThrottled=!1,this.throttlingDelta%=this.throttlingTime_ms)},this.onDocumentMouseMove=t=>{if(this.hasThrottled)return;this.hasThrottled=!0,t.preventDefault();const e=this.getIntersects(t);if(0===e.length)return void this.clearOver();const i=this.currentOver;this.currentOver=[];for(let t of e)if(this.checkTarget(t.object,"over"))break;i?.forEach((t=>{this.currentOver.includes(t)||_.onButtonHandler(t,"out")}))},this.onDocumentMouseUpDown=t=>{let e="down";switch(t.type){case"pointerdown":e="down";break;case"pointerup":e="up"}if(!y.isContain(this.canvas,this.viewport,t)&&"down"===e)return;t.preventDefault();const i=this.getIntersects(t);this.checkIntersects(i,e)},this.camera=e,this.scene=t,this.throttlingTime_ms=n?.throttlingTime_ms??33,this.viewport=n?.viewport,this.recursive=n?.recursive??!0,this.targets=n?.targets??this.scene.children,this.canvas=i,i.addEventListener("pointermove",this.onDocumentMouseMove,!1),i.addEventListener("pointerdown",this.onDocumentMouseUpDown,!1),i.addEventListener("pointerup",this.onDocumentMouseUpDown,!1),f.w.on("tick",this.onTick)}clearOver(){this.currentOver?.forEach((t=>{_.onButtonHandler(t,"out")})),this.currentOver=[]}checkIntersects(t,e){const i=t.length;if(0!==i)for(let s=0;s<i&&!this.checkTarget(t[s].object,e);s++);}static onButtonHandler(t,e){switch(e){case"down":return void t.interactionHandler.onMouseDownHandler(b.generate(e,t));case"up":return void t.interactionHandler.onMouseUpHandler(b.generate(e,t));case"over":return void(t.interactionHandler.isOver||t.interactionHandler.onMouseOverHandler(b.generate(e,t)));case"out":return void(t.interactionHandler.isOver&&t.interactionHandler.onMouseOutHandler(b.generate(e,t)))}}static implementsIClickableObject3D(t){return null!==t&&"object"==typeof t&&null!==t.interactionHandler&&"object"==typeof t.interactionHandler&&null!==t.interactionHandler.mouseEnabled&&"boolean"==typeof t.interactionHandler.mouseEnabled}static implementsDepartedIClickableObject3D(t){return null!==t&&"object"==typeof t&&null!==t.model&&"object"==typeof t.model}checkTarget(t,e,i=!1){return _.implementsDepartedIClickableObject3D(t)&&console.warn("Deprecated: IClickableObject3D.model is deprecated. Please use IClickableObject3D.interactionHandler."),null!=t&&_.implementsIClickableObject3D(t)&&t.interactionHandler.mouseEnabled?("over"===e&&this.currentOver.push(t),_.onButtonHandler(t,e),this.checkTarget(t.parent,e,!0)):null!=t&&null!=t.parent&&"Scene"!==t.parent.type?this.checkTarget(t.parent,e,i):i}getIntersects(t){y.convertToMousePosition(this.canvas,t,this.viewport,this.mouse),this.raycaster.setFromCamera(this.mouse,this.camera);const e=this.raycaster.intersectObjects(this.targets,this.recursive),i=new Set;return e.filter((t=>!i.has(t.object.uuid)&&(i.add(t.object.uuid),!0)))}}class b{static generate(t,e){const i=b.getInteractionHandler(e);return{type:t,interactionHandler:i,isSelected:(()=>{if("select"===t)return b.getSelection(i)})()}}static getInteractionHandler(t){return null!=t&&"interactionHandler"in t?t.interactionHandler:t}static getSelection(t){if(null!=t&&"selection"in t)return!!t.selection;throw new Error("選択可能なボタン以外を引数にして、SELECTイベントをインスタンス化しました。SELECTイベントはISelectableObject3Dを実装したクラスとともにインスタンス化してください。")}static clone(t){return b.generate(t.type,t.interactionHandler)}}class y{static getCanvasHeight(t){return t.clientHeight}static getCanvasWidth(t){return t.clientWidth}static convertToRectangle(t,e){const i=this.getCanvasHeight(t);return{x1:e.x,x2:e.x+e.width,y1:i-(e.y+e.height),y2:i-e.y}}static isContain(t,e,i){if(null==e)return!0;const s=this.convertToRectangle(t,e);return i.offsetX>=s.x1&&i.offsetX<=s.x2&&i.offsetY>=s.y1&&i.offsetY<=s.y2}static convertToMousePosition(t,e,i,n){const{x:r,y:a}=this.getMousePosition(t,e,i);return n?(n.set(r,a),n):new s.I9Y(r,a)}static getMousePosition(t,e,i){return i?this.getViewportMousePosition(t,e,i):this.getCanvasMousePosition(t,e)}static getCanvasMousePosition(t,e){return{x:e.offsetX/this.getCanvasWidth(t)*2-1,y:-e.offsetY/this.getCanvasHeight(t)*2+1}}static getViewportMousePosition(t,e,i){const s=this.convertToRectangle(t,i),n=e.offsetX-s.x1,r=e.offsetY-s.y1;return{x:n/(s.x2-s.x1)*2-1,y:-r/(s.y2-s.y1)*2+1}}}var H=i(753);let O,S,M;const k=()=>new g({normal:x(.6),over:x(.8),down:x(1),normalSelect:x(.6,16776960),overSelect:x(.8,16776960),downSelect:x(1,16776960)}),x=(t,e)=>(null==e&&(e=16777215),new s.V9B({color:e,opacity:t,transparent:!0})),D=()=>new g({normal:j("./btn045_01.png",1),over:j("./btn045_02.png",1),down:j("./btn045_03.png",1),normalSelect:j("./btn045_01.png",.5),overSelect:j("./btn045_02.png",.5),downSelect:j("./btn045_03.png",.5)}),j=(t,e,i)=>(null==i&&(i=16777215),new s.RoJ({map:(new s.Tap).load(t),color:i,opacity:e,transparent:!0})),C=(t,e)=>{t.position.set(e,20,0),t.scale.set(4,4,4),S.add(t)},T=()=>{O.render(S,M),requestAnimationFrame(T)};window.onload=()=>{console.log(`Three.js r${s.sPf}`),S=new s.Z58,M=new s.ubm(45,1280/900,1,400),M.position.set(0,0,100),S.add(M);const t={canvas:document.getElementById("webgl-canvas"),antialias:!0};O=new H.JeP(t),O.setClearColor(new s.Q1f(0)),O.setSize(1280,900),O.setPixelRatio(window.devicePixelRatio);const e=new s.$p8(16777215,1);S.add(e),new _(S,M,O.domElement),(()=>{const t=new s.iNn(3,3,3),e=new r({geo:t,material:k()});e.position.set(-10,20,0),S.add(e)})(),(()=>{const t=new s.iNn(3,3,3),e=new a({geo:t,material:k()});e.position.set(0,20,0),S.add(e)})(),(()=>{const t=new c(D());C(t,10)})(),(()=>{const t=new h(D());C(t,20)})(),(()=>{const t=new s.iNn(3,3,3),e=(e,i)=>{const s=new o({geo:t,material:k()});return s.position.set(e,-10,0),s.interactionHandler.value=i,S.add(s),s},i=new v;i.addButton(e(-10,"button01"),e(0,Math.PI),e(10,{value01:1,value02:2})),i.addButton(e(20,void 0)),i.on("select",(t=>{console.log(t.interactionHandler.value)}))})(),T()}}},i={};function s(t){var n=i[t];if(void 0!==n)return n.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,s),r.exports}s.m=e,t=[],s.O=(e,i,n,r)=>{if(!i){var a=1/0;for(h=0;h<t.length;h++){for(var[i,n,r]=t[h],o=!0,l=0;l<i.length;l++)(!1&r||a>=r)&&Object.keys(s.O).every((t=>s.O[t](i[l])))?i.splice(l--,1):(o=!1,r<a&&(a=r));if(o){t.splice(h--,1);var c=n();void 0!==c&&(e=c)}}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[i,n,r]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={795:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var n,r,[a,o,l]=i,c=0;if(a.some((e=>0!==t[e]))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(l)var h=l(s)}for(e&&e(i);c<a.length;c++)r=a[c],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(h)},i=self.webpackChunk_masatomakino_threejs_interactive_object=self.webpackChunk_masatomakino_threejs_interactive_object||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var n=s.O(void 0,[121],(()=>s(437)));n=s.O(n)})();