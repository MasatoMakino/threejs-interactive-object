(()=>{"use strict";var t,e={77:(t,e,i)=>{var n=i(710),s=i(753),r=i(486);function a(t){return null!=t&&"interactionHandler"in t?t.interactionHandler:t}function o(t){if(null!=t&&"selection"in t)return!!t.selection;throw new Error("選択可能なボタン以外を引数にして、SELECTイベントをインスタンス化しました。SELECTイベントはISelectableObject3Dを実装したクラスとともにインスタンス化してください。")}function l(t,e,i=1){const n=a(e);return{type:t,interactionHandler:n,isSelected:(()=>{if("select"===t)return o(n)})(),pointerId:i}}const c={getInteractionHandler:a,getSelection:o,generate:l,clone:function(t){return l(t.type,t.interactionHandler,t.pointerId)}};class h extends r.A{get materialSet(){return this._materialSet}set materialSet(t){const e=t===this._materialSet;this._materialSet=t,e||this.updateMaterial()}get isOver(){return this.hoverPointerIds.size>0}get isPress(){return this.pressPointerIds.size>0}get enabled(){return this._enable}get mouseEnabled(){return this.interactionScannable}set mouseEnabled(t){this.interactionScannable=t}get frozen(){return this._frozen}set frozen(t){this._frozen=t,t&&(this.pressPointerIds.clear(),this.hoverPointerIds.clear())}constructor(t){super(),this.pressPointerIds=new Set,this.hoverPointerIds=new Set,this._enable=!0,this.interactionScannable=!0,this._frozen=!1,this.state="normal",this._alpha=1,this.view=t.view,this._materialSet=t.material,this.updateMaterial()}onMouseDownHandler(t){this.checkActivity()&&(this.pressPointerIds.add(t.pointerId),this.updateState(this.calculateCurrentState()),this.emit(t.type,t))}onMouseUpHandler(t){const e=this.pressPointerIds.has(t.pointerId);if(this.pressPointerIds.delete(t.pointerId),this.checkActivity()&&(e&&this.pressPointerIds.clear(),this.updateState(this.calculateCurrentState()),this.emit(t.type,t),e)){this.onMouseClick();const e=l("click",this,t.pointerId);this.emit(e.type,e)}}onMouseClick(){}onMouseOverHandler(t){this.onMouseOverOutHandler(t)}onMouseOutHandler(t){this.onMouseOverOutHandler(t)}onMouseOverOutHandler(t){"over"===t.type&&this.hoverPointerIds.has(t.pointerId)||("over"===t.type?this.hoverPointerIds.add(t.pointerId):this.hoverPointerIds.delete(t.pointerId),"out"===t.type&&this.pressPointerIds.delete(t.pointerId),this.checkActivity()&&(this.updateState(this.calculateCurrentState()),this.emit(t.type,t)))}set alpha(t){this._alpha=Math.max(0,t),this.updateMaterial()}updateState(t){this.state=t,this.updateMaterial()}checkActivity(){return this._enable&&!this.frozen}enable(){this.switchEnable(!0)}disable(){this.switchEnable(!1)}updateMaterial(){this._materialSet?.setOpacity(this._alpha);const t=this._materialSet?.getMaterial(this.state,this._enable);if(t)switch(this.view.type){case"Mesh":case"Sprite":this.view.material=t.material}}switchEnable(t){if(this._enable=t,!t)return this.pressPointerIds.clear(),this.hoverPointerIds.clear(),void this.updateState("disable");this.pressPointerIds.clear(),this.updateState(this.calculateCurrentState())}calculateCurrentState(){return this._enable?this.isPress?"down":this.isOver?"over":"normal":"disable"}}class u extends h{constructor(){super(...arguments),this._isSelect=!1}onMouseClick(){if(!this.checkActivity())return;this._isSelect=!this._isSelect;const t=l("select",this);this.emit(t.type,t),this.updateMaterial()}get selection(){return this._isSelect}set selection(t){t!==this._isSelect&&this.checkActivity()&&(this._isSelect=t,this.pressPointerIds.clear(),this.updateMaterial())}updateMaterial(){this.materialSet?.setOpacity(this._alpha);const t=this.materialSet?.getMaterial(this.state,this._enable,this._isSelect);null!=t?.material&&(this.view.material=t.material)}}class d extends u{constructor(){super(...arguments),this._isExclusivelySelected=!1}checkActivity(){return super.checkActivity()&&!this._isExclusivelySelected}get isExclusivelySelected(){return this._isExclusivelySelected}set isExclusivelySelected(t){this._isExclusivelySelected=t}get isFrozen(){return this._isExclusivelySelected}set isFrozen(t){this._isExclusivelySelected=t}_setSelectionOverride(t){if(this._isSelect=t,t)this.updateState("normal");else{const t=this.calculateCurrentState();this.updateState(t)}}}var p=i(961);class v{constructor(t,e,i,s){this.raycaster=new n.tBo,this.mouse=new n.I9Y,this.currentOver=new Map,this.hasThrottled=new Set,this.throttlingDelta=0,this._disposed=!1,this.onTick=t=>this.throttlingTime_ms<=0?(this.hasThrottled.clear(),void(this.throttlingDelta=0)):Number.isFinite(t.delta)?(this.throttlingDelta+=Math.max(t.delta,0),void(this.throttlingDelta<this.throttlingTime_ms||(this.hasThrottled.clear(),this.throttlingDelta%=this.throttlingTime_ms))):(this.hasThrottled.clear(),void(this.throttlingDelta=0)),this.onDocumentMouseMove=t=>{const e=t.pointerId;if(this.throttlingTime_ms>0){if(this.hasThrottled.has(e))return;this.hasThrottled.add(e)}t.preventDefault();const i=this.getIntersects(t);if(0===i.length)return void this.clearOver(e);const n=this.currentOver.get(e)||[];this.currentOver.set(e,[]);for(const t of i)if(this.checkTarget(t.object,"over",e))break;n.forEach((t=>{(this.currentOver.get(e)||[]).includes(t)||v.onButtonHandler(t,"out",e)}))},this.onDocumentMouseUpDown=t=>{const e=t.pointerId;let i="down";switch(t.type){case"pointerdown":i="down";break;case"pointerup":i="up"}if(!function(t,e,i){if(null==e)return!0;const n=S(t,e);return i.offsetX>=n.x1&&i.offsetX<=n.x2&&i.offsetY>=n.y1&&i.offsetY<=n.y2}(this.canvas,this.viewport,t)&&"down"===i)return;t.preventDefault();const n=this.getIntersects(t);this.checkIntersects(n,i,e)},this.onDocumentPointerCancel=t=>{t.cancelable&&t.preventDefault(),this.cleanupPointerState(t.pointerId)},this.onDocumentPointerLeave=t=>{this.cleanupPointerState(t.pointerId)},this.camera=e,this.scene=t,this.throttlingTime_ms=s?.throttlingTime_ms??33,this.viewport=s?.viewport,this.recursive=s?.recursive??!0,this.targets=s?.targets??this.scene.children,this.canvas=i,i.addEventListener("pointermove",this.onDocumentMouseMove,!1),i.addEventListener("pointerdown",this.onDocumentMouseUpDown,!1),i.addEventListener("pointerup",this.onDocumentMouseUpDown,!1),i.addEventListener("pointercancel",this.onDocumentPointerCancel,!1),i.addEventListener("pointerleave",this.onDocumentPointerLeave,!1),p.w.on("tick",this.onTick)}clearOver(t){void 0!==t?((this.currentOver.get(t)||[]).forEach((e=>{v.onButtonHandler(e,"out",t)})),this.currentOver.delete(t)):(this.currentOver.forEach(((t,e)=>{t.forEach((t=>{v.onButtonHandler(t,"out",e)}))})),this.currentOver.clear())}cleanupPointerState(t){const e=this.currentOver.get(t);e&&e.length>0&&e.forEach((e=>{v.onButtonHandler(e,"out",t)})),this.currentOver.delete(t),this.hasThrottled.delete(t)}checkIntersects(t,e,i=1){const n=t.length;if(0!==n)for(let s=0;s<n&&!this.checkTarget(t[s].object,e,i);s++);}static onButtonHandler(t,e,i=1){switch(e){case"down":return void t.interactionHandler.onMouseDownHandler(l(e,t,i));case"up":return void t.interactionHandler.onMouseUpHandler(l(e,t,i));case"over":return void t.interactionHandler.onMouseOverHandler(l(e,t,i));case"out":return void t.interactionHandler.onMouseOutHandler(l(e,t,i))}}static implementsIClickableObject3D(t){return null!==t&&"object"==typeof t&&"interactionHandler"in t&&null!==t.interactionHandler&&"object"==typeof t.interactionHandler&&"interactionScannable"in t.interactionHandler&&null!==t.interactionHandler.interactionScannable&&"boolean"==typeof t.interactionHandler.interactionScannable}static implementsDepartedIClickableObject3D(t){return null!==t&&"object"==typeof t&&"model"in t&&null!==t.model&&"object"==typeof t.model}checkTarget(t,e,i=1,n=!1){if(v.implementsDepartedIClickableObject3D(t)&&console.warn("Deprecated: IClickableObject3D.model is deprecated. Please use IClickableObject3D.interactionHandler."),null!=t&&v.implementsIClickableObject3D(t)&&t.interactionHandler.interactionScannable){if("over"===e){const e=this.currentOver.get(i)||[];e.push(t),this.currentOver.set(i,e)}return v.onButtonHandler(t,e,i),this.checkTarget(t.parent,e,i,!0)}return null!=t&&null!=t.parent&&"Scene"!==t.parent.type?this.checkTarget(t.parent,e,i,n):n}getIntersects(t){!function(t,e,i,s){const{x:r,y:a}=function(t,e,i){return i?function(t,e,i){const n=S(t,i),s=e.offsetX-n.x1,r=e.offsetY-n.y1;return{x:s/(n.x2-n.x1)*2-1,y:-r/(n.y2-n.y1)*2+1}}(t,e,i):function(t,e){const i=e.offsetX/function(t){return t.clientWidth}(t)*2-1;return{x:i,y:-e.offsetY/y(t)*2+1}}(t,e)}(t,e,i);if(s)return s.set(r,a),s;new n.I9Y(r,a)}(this.canvas,t,this.viewport,this.mouse),this.raycaster.setFromCamera(this.mouse,this.camera);const e=this.raycaster.intersectObjects(this.targets,this.recursive),i=new Set;return e.filter((t=>!i.has(t.object.uuid)&&(i.add(t.object.uuid),!0)))}dispose(){this._disposed||(this._disposed=!0,this.clearOver(),this.canvas.removeEventListener("pointermove",this.onDocumentMouseMove,!1),this.canvas.removeEventListener("pointerdown",this.onDocumentMouseUpDown,!1),this.canvas.removeEventListener("pointerup",this.onDocumentMouseUpDown,!1),this.canvas.removeEventListener("pointercancel",this.onDocumentPointerCancel,!1),this.canvas.removeEventListener("pointerleave",this.onDocumentPointerLeave,!1),p.w.off("tick",this.onTick),this.hasThrottled.clear(),this.throttlingDelta=0)}}class m extends r.A{constructor(){super(...arguments),this._interactionHandlers=[],this.onSelectedButton=t=>{t.isSelected&&this.select(t.interactionHandler)}}addButton(...t){t.forEach((t=>{this.addInteractionHandler(t.interactionHandler)}))}addInteractionHandler(t){this._interactionHandlers.push(t),t.on("select",this.onSelectedButton)}removeButton(t){this.removeInteractionHandler(t.interactionHandler)}removeInteractionHandler(t){const e=this._interactionHandlers.indexOf(t);return e>-1&&(this._interactionHandlers.splice(e,1),t.off("select",this.onSelectedButton)),t}select(t){if(-1===this._interactionHandlers.indexOf(t))return void console.warn("管理下でないボタンが選択処理されました。");if(t===this._selected&&t.isExclusivelySelected)return;this._selected=t;for(const e of this._interactionHandlers)e.isExclusivelySelected=e===t,e._setSelectionOverride(e===t);const e=c.generate("select",t);this.emit(e.type,e)}get selected(){return this._selected}get interactionHandlers(){return[...this._interactionHandlers]}}class f{constructor(t){this.alpha=1,this.material=t}updateAlpha(){Array.isArray(this._material)?this.alphaArray=this.getAlphaArray():this.alpha=this._material.opacity}getAlphaArray(){const t=this._material,e=t.length,i=[];for(let n=0;n<e;n++)i.push(t[n].opacity);return i}set material(t){this._material=t,this.updateAlpha()}get material(){return this._material}setOpacity(t){if(Array.isArray(this._material)){const e=this._material.length;for(let i=0;i<e;i++)this._material[i].opacity=t*this.alphaArray[i]}else this._material.opacity=t*this.alpha}}class w{constructor(t){this.materials=[],this.normal=new f(t.normal),this.over=w.initMaterial(t.over,this.normal),this.down=w.initMaterial(t.down,this.normal),this.disable=w.initMaterial(t.disable,this.normal),this.normalSelect=w.initMaterial(t.normalSelect,this.normal),this.overSelect=w.initMaterial(t.overSelect,this.normal),this.downSelect=w.initMaterial(t.downSelect,this.normal),this.init()}static initMaterial(t,e){return null==t?e:new f(t)}init(){if(null==this.normal)throw new Error("通常状態のマテリアルが指定されていません。");this.materials=[this.normal,this.normalSelect,this.over,this.overSelect,this.down,this.downSelect,this.disable]}getMaterial(t,e,i=!1){if(!e)return this.disable;switch(t){case"normal":return i?this.normalSelect:this.normal;case"down":return i?this.downSelect:this.down;case"over":return i?this.overSelect:this.over}return this.normal}setOpacity(t){this.materials.forEach((e=>{e.setOpacity(t)}))}}function y(t){return t.clientHeight}function S(t,e){const i=y(t);return{x1:e.x,x2:e.x+e.width,y1:i-(e.y+e.height),y2:i-e.y}}n.YJl;class b extends n.eaF{constructor(t,e){super(t.geo),this.interactionHandler=new e({view:this,material:t.material})}}class g extends b{constructor(t){super(t,h)}}class _ extends b{constructor(t){super(t,u)}}class O extends b{constructor(t){super(t,d)}}class H extends n.kxk{constructor(t,e){super(),this.interactionHandler=new e({view:this,material:t})}}class I extends H{constructor(t){super(t,h)}}class M extends H{constructor(t){super(t,u)}}let x,k,P;const D=()=>new w({normal:E(.6),over:E(.8),down:E(1),normalSelect:E(.6,16776960),overSelect:E(.8,16776960),downSelect:E(1,16776960)}),E=(t,e)=>(null==e&&(e=16777215),new n.V9B({color:e,opacity:t,transparent:!0})),j=()=>new w({normal:T("./btn045_01.png",1),over:T("./btn045_02.png",1),down:T("./btn045_03.png",1),normalSelect:T("./btn045_01.png",.5),overSelect:T("./btn045_02.png",.5),downSelect:T("./btn045_03.png",.5)}),T=(t,e,i)=>(null==i&&(i=16777215),new n.RoJ({map:(new n.Tap).load(t),color:i,opacity:e,transparent:!0})),C=(t,e)=>{t.position.set(e,20,0),t.scale.set(4,4,4),k.add(t)},A=()=>{x.render(k,P),requestAnimationFrame(A)};window.onload=()=>{console.log(`Three.js r${n.sPf}`),k=new n.Z58,P=new n.ubm(45,1280/900,1,400),P.position.set(0,0,100),k.add(P);const t=document.getElementById("webgl-canvas"),e={canvas:t,antialias:!0};x=new s.JeP(e),x.setClearColor(new n.Q1f(0)),x.setSize(1280,900),x.setPixelRatio(window.devicePixelRatio),t.style.width="1280px",t.style.height="900px",t.style.touchAction="none",Object.assign(t.style,{userSelect:"none",outline:"none"}),t.style.setProperty("-webkit-user-select","none"),t.style.setProperty("-moz-user-select","none"),t.style.setProperty("-ms-user-select","none"),t.style.setProperty("-webkit-tap-highlight-color","transparent"),t.style.setProperty("-webkit-touch-callout","none");const i=new n.$p8(16777215,1);k.add(i),new v(k,P,x.domElement),(()=>{const t=new n.iNn(3,3,3),e=new g({geo:t,material:D()});e.position.set(-10,20,0),k.add(e)})(),(()=>{const t=new n.iNn(3,3,3),e=new _({geo:t,material:D()});e.position.set(0,20,0),k.add(e)})(),(()=>{const t=new I(j());C(t,10)})(),(()=>{const t=new M(j());C(t,20)})(),(()=>{const t=new n.iNn(3,3,3),e=(e,i)=>{const n=new O({geo:t,material:D()});return n.position.set(e,-10,0),n.interactionHandler.value=i,k.add(n),n},i=new m;i.addButton(e(-10,"button01"),e(0,Math.PI),e(10,{value01:1,value02:2})),i.addButton(e(20,void 0)),i.on("select",(t=>{console.log(t.interactionHandler.value)}))})(),A()}}},i={};function n(t){var s=i[t];if(void 0!==s)return s.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.m=e,t=[],n.O=(e,i,s,r)=>{if(!i){var a=1/0;for(h=0;h<t.length;h++){for(var[i,s,r]=t[h],o=!0,l=0;l<i.length;l++)(!1&r||a>=r)&&Object.keys(n.O).every((t=>n.O[t](i[l])))?i.splice(l--,1):(o=!1,r<a&&(a=r));if(o){t.splice(h--,1);var c=s();void 0!==c&&(e=c)}}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[i,s,r]},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={795:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var s,r,[a,o,l]=i,c=0;if(a.some((e=>0!==t[e]))){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)var h=l(n)}for(e&&e(i);c<a.length;c++)r=a[c],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(h)},i=self.webpackChunk_masatomakino_threejs_interactive_object=self.webpackChunk_masatomakino_threejs_interactive_object||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var s=n.O(void 0,[121],(()=>n(77)));s=n.O(s)})();